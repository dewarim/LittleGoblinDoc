<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Little Goblin Plugin 0.3.2</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#installation"><strong>2</strong><span>Installation</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#features"><strong>3</strong><span>Features</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#implementation"><strong>4</strong><span>Plugin Usage</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>Little Goblin is a browser game framework written in Grails.</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Little Goblin Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> </p>
                            <p><strong>Version:</strong> 0.3.2</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#changes"><strong>1.1</strong><span>Change Log</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#installation"><strong>2</strong><span>Installation</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#binary"><strong>2.1</strong><span>Installing the binary package</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#source"><strong>2.2</strong><span>Installing the source code</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#features"><strong>3</strong><span>Features</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#infrastructure"><strong>3.1</strong><span>Infrastructure</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#game"><strong>3.2</strong><span>The Game</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#combat"><strong>3.3</strong><span>Combat</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#reputation"><strong>3.4</strong><span>Reputation</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#skills"><strong>3.5</strong><span>Skills</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#guilds"><strong>3.6</strong><span>Guilds</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#items"><strong>3.7</strong><span>Items</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#crafting"><strong>3.8</strong><span>Crafting</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#orders"><strong>3.9</strong><span>Orders</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#quests"><strong>3.10</strong><span>Quests</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#implementation"><strong>4</strong><span>Plugin Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#create"><strong>4.1</strong><span>How to create a new game</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#landing"><strong>4.2</strong><span>The landing page</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
Little Goblin is an open source browser game framework that is intended to help you 
to create browser games. The goal is to have all the infrastructure in place allowing you 
to implement your idea as fast as possible, because the quickest way to bring (hobby) game 
development to a halt is (in my experience) to get bogged down in a quagmire of administrative
 tasks and configuration details. The Little Goblin framework strives to speed up your
 development without having to handle all the fundamental stuff,
like user accounts, security, administration features and so on.<p class="paragraph"/>Of course, as it is in Grails,
so should be in this framework: just because the framework makes it easy to ignore the
underlying complexity at first, you can always dig deeper and hack and improve the system.<p class="paragraph"/>
<h2>License</h2><p class="paragraph"/>Little Goblin is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="blank">Apache License 2.0</a> -
in short this means you can use it for commercial and non-commercial purposes and it comes without any warranties.<p class="paragraph"/><h2>Contact / Links</h2>
<ul class="star">
<li>Project Admin: Ingo Wiarda / ingo_wiarda@dewarim.de</li>
<li>Demo Website: http://schedim.de</li>
<li>Blog for LittleGoblin: http://dewarim.com</li>
<li>Documentation: http://littlegoblin.de</li>
<li>Sourceforge page: http://sourceforge.net/projects/littlegoblin</li>
<li>GitHub page: https://github.com/dewarim/LittleGoblin</li>
</ul><p class="paragraph"/>


<h2 id="changes">1.1 Change Log</h2>
<strong class="bold">Version 0.3.2 "Tick-Tock"</strong>
<ul class="star">
<li>Fixed #3: add gameName config parameter as default title to pages.</li>
<li>Changed: Run game ticks in a background thread (no more need for a cron job to run ticks).</li>
<li>Fixed #14: Version link in footer was broken.</li>
</ul><p class="paragraph"/><strong class="bold">Version 0.3.1 "Resume"</strong>
<ul class="star">
<li>Fixed: admin can edit ItemTypes again.</li>
<li>New: admin can assign categories to item types.</li>
<li>Fixed: inputValidationService no longer croaks on 'null'-String.</li>
<li>Cleanup code.</li>
<li>Added more documentation (items, guilds)</li>
<li>Project is now language level Java 7</li>
<li>Grails 2.2.0</li>
</ul><p class="paragraph"/><strong class="bold">Version 0.3.0 "Cleanup"</strong> 
(a lot of internal changes)
<ul class="star">
<li>Updated to Grails 2.1.1.</li>
<li>Fixed session handling.</li>
<li>Fixed HTML error in /goblinOrder/_order_list</li>
<li>Refactoring pages to use sitemesh layout instead of using homebrew solution.</li>
<li>Fixed item filter: remove unnecessary conversion of list to array. (ItemService).</li>
<li>Removed old prototyps JS-library files since we have been using jQuery for some time.</li>
<li>Fixed message id in highscore.gsp.</li>
<li>Added more documentation.</li>
<li>Added custom equals &#38; hashCode to many domain classes.</li>
<li>Fixed: do not double-encode chatterbox messages.</li>
<li>Fixed: textarea in chatterbox.</li>
<li>Removed redundant "def inputValidationService", which is inherited from BaseController.</li>
</ul><p class="paragraph"/><strong class="bold">Version 0.2.7</strong>
<ul class="star">
<li>Fixed cronGoblin and CronController for recurring events (would previously go into an infinite loop).</li>
<li>Added configurable registration with confirmation mail.</li>
<li>Added testMode parameter to config file.</li>
<li>Updated spring-security-core plugin</li>
<li>Added FeatureAdminController.</li>
<li>Upgraded to Grails 2.1.1</li>
</ul><p class="paragraph"/>


<h1 id="installation">2 Installation</h1>



<h2 id="binary">2.1 Installing the binary package</h2>
Please install / configure the following software packages to get started with the Little Goblin binary package:<p class="paragraph"/><h3>Download the binary package</h3><p class="paragraph"/>Download the binary package <a href="http://download.littlegoblin.de/files/current/goblin.war" target="blank">Little Goblin Binary</a><p class="paragraph"/><h3>Java</h3>
Download and install the Java 7 runtime from http://java.com/<p class="paragraph"/>On Ubuntu: sudo apt-get install openjdk-7-jre<p class="paragraph"/><h3>Tomcat 7</h3>
Download and install Tomcat 7 from http://tomcat.apache.org<p class="paragraph"/>On Ubuntu, use: sudo apt-get install tomcat7<p class="paragraph"/><h3>Install an RDBMS (Database)</h3><p class="paragraph"/>Download a database and configure it, either: <a href="http://mysql.com" target="blank">MySQL</a>
or <a href="http://postgresql.org" target="blank">Postgresql</a> (the latter is recommended).<p class="paragraph"/>Create a database user "goblin" with password "goblin" (for testing)<p class="paragraph"/>If you want to use mysql, please download the database driver and place it into
your Tomcat's lib folder. (It is not included in the goblin.war for license reasons.)<p class="paragraph"/><h3>Configure your version</h3><p class="paragraph"/>Create in you home directory a folder .grails
and inside a file goblin-config.groovy. 
You can download an example version from
<a href="https://github.com/dewarim/LittleGoblin/blob/master/goblin-config.example.groovy" target="blank">GitHub</a>
<ul class="star">
<li>Set the serverUrl to your machine's or server's name (http://localhost or your domain name)</li>
<li>Edit the database settings for the production database.</li>
</ul><p class="paragraph"/>If you want to create a new database on every server start and delete the old data,  
keep the setting of dbCreate="create". Otherwise, set it to dbCreate="none".<p class="paragraph"/>If you have any questions, you can:
<ul class="star">
<li>Ask on the <a href="https://sourceforge.net/mailarchive/forum.php?forum_name=littlegoblin-main" target="blank">project mailing list</a></li>
<li>Add a question to the <a href="https://github.com/dewarim/LittleGoblin/issues" target="blank">issue tracker on GitHub</a></li>
<li>Write me a mail: ingo_wiarda@dewarim.de</li>
</ul><p class="paragraph"/>


<h2 id="source">2.2 Installing the source code</h2>
<h2>Checkout the source code</h2><p class="paragraph"/>You can get the source code from the <a href="https://github.com/dewarim/LittleGoblin" target="blank">Little Goblin GitHub repository</a><p class="paragraph"/>It is available as a <a href="https://github.com/dewarim/LittleGoblin/downloads" target="blank">zip or tar archive</a> or (recommended) 
as a git repository which you can clone via  
bq. git clone git://github.com/dewarim/LittleGoblin.git<p class="paragraph"/><h3>Prerequisites to running from source</h3>
<ul class="star">
<li>you need Java, a database and the configuration file - see <a href="../guide/single.html#binary" class="guide">Binary install instructions</a>.</li>
<li>Grails - which you will find on <a href="http://grails.org" target="blank">Grails.org</a></li>
</ul><p class="paragraph"/>After you have installed the dependencies, use the command line to run Grails in Little Goblin's main directory:
<code>grails</code> and start the application with <code>run-app</code><p class="paragraph"/><h3>Use as a plugin</h3><p class="paragraph"/>Add the following line to your Grails application's BuildConfig.groovy (in the plugins section):<p class="paragraph"/><div class="code"><pre>compile ':little&#45;goblin:0.3.2'</pre></div><p class="paragraph"/>As a starting point, look at the BootStrap.groovy code in the plugin's source on how to populate the database
with essential objects like an admin user. You can login to your application via http://localhost:8080/$appName/portal/landing,
where $appName stands for your Grails application's name. Then it's time to begin customizing the game engine and 
to add your own content. (Extensive documentation on how to do this will follow - if anything is unclear or does not work,
please to not hesitate to <a href="https://github.com/dewarim/LittleGoblinDoc/issues/" target="blank">ask or add an issue</a> )
 


<h1 id="features">3 Features</h1>
Little Goblin already has a lot of features, and more will come. This part of the documentation gives an
overview over the current project status. A more detailed description of the inner workings will follow
 in the more technical sections later on.



<h2 id="infrastructure">3.1 Infrastructure</h2>
The main goal of the Little Goblin framework is to enable you to quickly turn
your ideas into a working software project. To this end, the following is provided:<p class="paragraph"/><h3>User registration</h3><p class="paragraph"/>User registration works via sending a confirmation link to the user's email address.
If the user clicks on the link therein, his account will be activated.<p class="paragraph"/><h3>License management</h3><p class="paragraph"/>Depending on the system's configuration, it's possible to let users create their own content.
In this case, you really need to get the licensing done right - as well as in the case where
you use media assets from the public domain (for example, Wikimedia). Often, the artist requires
 his name to appear in the context of the artwork - and even when there is no such request, it
 is the right and polite thing to do. And you never know when a lawyer comes a-knocking because
 someone mistakenly thinks you did use one of their images without permission.<p class="paragraph"/>Little Goblin allows you to create license objects which can be assigned to images (and perhaps
later on other assets). Currently this is implemented for monster images, which can be tagged with
a license. TODO: display licenses, not just store them - but at least the artist credit works.<p class="paragraph"/><h3>Artist management</h3><p class="paragraph"/>As with licenses, you can also manage artists in Little Goblin. Currently, when a monster is displayed,
a link is shown which leads to the artist's web site. An artist may own any number of images associated
with him. TODO: public display of artist gallery<p class="paragraph"/><h3>Image management</h3><p class="paragraph"/>With the artist and licenses defined, you can assign them to images and those to one or more game assets 
(at the moment: to monsters). This way, a image can be re-used for more than one creature. While in an
ideal game, you would use images only exactly once, it may be a way for budget games to re-use them until
better and more artwork is available.<p class="paragraph"/>More than one image can be assigned to a creature and they will be used randomly, so you can add some 
visual spice for the users.  
Also, in the case of unique creatures / mobs of a certain type, it is possible to assign the generic image 
(for example: when you generate an encounter with a special named mob, it could show up with the image for "Boss mob orc",
the only difference being the mob's combat values, like in many action RPGs).<p class="paragraph"/><h3>In-Game messaging</h3><p class="paragraph"/><h4>Simple messages</h4><p class="paragraph"/>Little Goblin offers in-game messaging via a simple inbox model. Users can write messages to other characters,
and reply to them. The messages can be archived or deleted. TODO: implement sent-as-email feature<p class="paragraph"/><h4>Guild's chatterbox</h4><p class="paragraph"/>Guilds offer a special feature: a chatterbox were all guild members can exchange messages in life chat. This
is intended for non-persistent communication, as older messages will be deleted once the box fills up with new
chatter.


<h2 id="game">3.2 The Game</h2>
When started with an empty database, Little Goblin can create a ready-to run fantasy game
with a test account and a few quests, items, monsters and so on, allowing you to test 
the basic game features.<p class="paragraph"/>The reference implementation is a game that tries to use all the features offered by the framework.



<h2 id="combat">3.3 Combat</h2>
Combat in Little Goblin currently is the fight between a player character and a monster or, 
 in the case of the Grand Melee (see below) between all willing player characters. A fight is started
 by meeting a monster during a quest encounter. The fight will go on until the player wins, flees or
 is defeated.<p class="paragraph"/>Combat is round-based. At the moment, the player has the option to 
<ul class="star">
<li>use items from his or her inventory</li>
<li>to attack the opponent</li>
<li>run away</li>
</ul><p class="paragraph"/>Running away is always successful and terminates the current quest.
Attacking uses the currently equipped weapon(s) and passive abilities to determine the effects
  on the opponent.<p class="paragraph"/><h3>A closeup of a fight</h3><p class="paragraph"/>A round of combat consists of the following steps:
<ul class="star">
<li>determine initiative (rolling a d20 at the moment, add bonuses)</li>
<li>attacker rolls to strike</li>
<li>defender rolls to parry</li>
<li>in case of a hit, compute damage from all items that contribute to damage dealt.</li>
<li>check if both combatants are alive</li>
<li>counter attack of the defender (strike, parry, deal damage, check result)</li>
<li>either finish the combat sequence or start a new round</li>
</ul><p class="paragraph"/><h4>Special damage and mitigation</h4><p class="paragraph"/>Items or a creature's natural abilities may deal special damage (for example, a dragon breathing fire).
This is included via a damage multiplier, so a dragon may deal fire damage which increases its base
damage by a factor of 1.2. If this dragon is also for some reason a creature of chaos, it may increase
the damage further by another factor of 1.3. Likewise, the abilities or items of a fighter may reduce
the damage dealt by a certain factor. A ring of protection from chaos may reduce damage with chaotic
influence by a factor of 0.5 (so chaos damage is reduced by 50%).<p class="paragraph"/>Note that in this simple combat model an armor of protection from fire will reduce the  <em class="italic">total</em>  damage, 
not the percentage of the damage that is actually dealt be heat. So, attacking a creature that is virtually
immune to fire with a +20 burning sword of fire,death,chaos,poison is not the best strategy.<p class="paragraph"/><h3>The Grand Melee</h3><p class="paragraph"/>The Grand Melee is Highlander-style combat szenario where all participants will fight each other
until only the winner is left standing. It is round based with a fixed timeout to prevent players
  from waiting too long before committing to an action. (If a player does not submit an action,
  his character will attack a random opponent).<p class="paragraph"/>


<h2 id="reputation">3.4 Reputation</h2>
Reputation is the sum off what a group of people have come to expect of you.<p class="paragraph"/>In Little Goblin, you can define factions, which may align on race (Elves, Dwarves) or other
distinguishing characteristics. If a player character makes a decision during a quest,
his or her reputation in respect to the affected factions should change.<p class="paragraph"/>If at a later state of the game the character interacts again with factions he has now
a positive or negative reputation with, the options offered and behaviour displayed 
should be influenced by this.<p class="paragraph"/>Reputation is not presented as a number to the player, because such a score is not very meaningful.
For display, a reputation map is used, which contains descriptions for negative and positive
reputation states. Note that reputation at this point is either positive, neutral or negative -
the code does not define ambivalent feelings or track the reputation history, so the sentiment "She was once
 a heroine and a force of good reputation:1000, but she has fallen a long way reputation:0,
 still we should give her a chance." can currently not be expressed. But then, modeling
 behaviour of NPCs according to the current reputation is sufficient - the memories of
 an orcish trader do not need to be longer and more nuanced than that of the average voter.<p class="paragraph"/>Example of a reputation message map which goes from -41 to +41:<p class="paragraph"/><pre class="bq"><code> repMessages = 'unknown': [0,
               'good': 1, 'very.good': 11, 'very.very.good': 21,  'best': 41,
               'bad': -1, 'very.bad': -11, 'extremely.bad': -21, 'worst': -41]</code></pre><p class="paragraph"/>Example of reputation messages:<p class="paragraph"/><pre class="bq"><code>    reputation.unknown=We have never heard of you.
    reputation.good=We like you.
    reputation.very.good=We think highly of you.
    reputation.very.very.good=We love you.
    reputation.best=Our lives are blessed by your very presence.
    reputation.bad=We dislike you.
    reputation.very.bad=We hate you.
    reputation.extremely.bad=We will kill you on sight.
    reputation.worst=We are going to kill you and leave your for the ravens</code></pre><p class="paragraph"/>(Of course, you can define the messages in a more appropriate way or from a 3rd-person point of view.)



<h2 id="skills">3.5 Skills</h2>
Players characters and more generally creatures (mobs) may have skills. 
Skills can be learned at academies.
Access to academies requires membership in a guild. In Little Goblin, guilds are
organizations for all those pursuing a specific trade, like in the middle ages.
They are  <em class="italic">not</em>  created by the players. Players may create "orders" (in the sense of
  a military and / or religious organization, for example the Knights Templar).<p class="paragraph"/>Academies like the fighter's guild will offer skills, or more precisely, skill sets.
A "skill set" is a course which confers a specific skill like "fighting 101" to a player
character - for a price and requiring a certain amount of time. It is possible to have 
multiple academies teaching the same skill via differently prices skill sets (courses).
Skill sets have a required level relevant to the academy that teaches them - so a player
character may only learn them in a specific order.<p class="paragraph"/>Skills are scriptable: you can associate a class with a skill which will be run when a
player character learns this skill. The class will receive the PC, the CreatureSkill instance 
which connects the character with this skill instance and the skill's configuration field as
parameters. The configuration field is an XML string and may hold initialization values.<p class="paragraph"/><h3>Combat Skills</h3><p class="paragraph"/>Combat skills extend the basic skill class with combat specific fields. Currently, those are Dice objects
which offer bonuses for:
<ul class="star">
<li>strike</li>
<li>parry</li>
<li>initiative</li>
<li>damage</li>
</ul><p class="paragraph"/><h3>Production Skills</h3><p class="paragraph"/>Production skills extend the basic skill class and allow a player use create new products (items).
When a PC learns a new production skill, a range of new products may become available for crafting.<p class="paragraph"/>


<h2 id="guilds">3.6 Guilds</h2>
Guilds in Little Goblin represent trade associations, much like the medieval guilds which were created by craftsmen
seeking to build communities of like-minded professionals. They jealously guard the secrets of their trades and
seek to create a monopolistic power structure where the only people who are allowed to practice (and capable, due 
to the control of information) the trade, are those who belong to the guild.<p class="paragraph"/>In game terms, a player character who wishes to learn a craft should become a member of the respective guild.
 This will grant him or her access to the guild's academy and possibly other resources. Some skills may be transferred
 outside of the regular guild curriculum, either as quest rewards or through other events.<p class="paragraph"/>Note: player guilds are called orders in Little Goblin.<p class="paragraph"/><h3>Ideas for guilds</h3><p class="paragraph"/>While currently not implemented, guilds may become controlled or influenced by players. Also guild membership
may later on depend on reputation or quests.
 


<h2 id="items">3.7 Items</h2>
Items are among the most complex features of Little Goblin. 
A player character may own any number of them, and they may have special uses and effects which can be activated
 when the time is right.<p class="paragraph"/><h2>Item types</h2><p class="paragraph"/>All items have a specific item type which defines:<p class="paragraph"/><h3>Required slots</h3><p class="paragraph"/>To equip an item (so it can be used), one or more free equipment slots are necessary.
An equipment slot may be a body part (an iron helmet requires a free head slot) or,
in a later version of the framework, a space ship (a photon torpedo needs a weapons bay).<p class="paragraph"/>Current equipment slot types (in the reference implementation - you are free to change them in
your game):
<ul class="star">
<li>head</li>
<li>neck</li>
<li>body</li>
<li>hand</li>
<li>finger</li>
<li>legs</li>
<li>feet</li>
</ul><p class="paragraph"/>A character may have more than one of each slot type (of course, having two heads only makes
sense if you play an Ettin...)<p class="paragraph"/><h3>Attributes</h3><p class="paragraph"/>An item may have any number of item attributes. A sword of flames will have a weapon attribute of type
"fire" and a corresponding damage modified. Combat attributes are used to calculate damage - a sword of 
fire will do more damage against an ice monster.<p class="paragraph"/>Current combat attributes include:
<ul class="star">
<li>fire</li>
<li>acid</li>
<li>water</li>
<li>cold</li>
<li>electricity</li>
<li>death</li>
<li>light</li>
<li>chaos</li>
<li>sound</li>
<li>poision</li>
<li>shards</li>
<li>normal</li>
</ul><p class="paragraph"/><h3>Item categories</h3><p class="paragraph"/>Categories are used group items according to their basic aspects, you can think of them as tags for 
item properties. For example, a magic potion of healing will belong to the categories 'potion' and 'magic'
<ul class="minus">
<li>and perhaps 'healing', if you expect to have a lot of healing items. Shops will not always carry</li>
</ul><p class="paragraph"/>items of all categories and some may in fact only carry potions or weapons.<p class="paragraph"/>Initial item categories (for the handful of test items):
<ul class="star">
<li>potion</li>
<li>magic</li>
<li>mushroom</li>
<li>metal</li>
<li>armor</li>
<li>weapon</li>
</ul><p class="paragraph"/> 
<h3>Combat damage</h3><p class="paragraph"/>A weapon is simply defined as an item which has a combat dice value set. Dice determine the base
damage an item will do via the formula ( number of sides * number of dice) + bonus value. You can name
your dice and reuse them for different items, for example "Dice: short swords" or "Dice: Phasers".<p class="paragraph"/>h3 Stackable and package size<p class="paragraph"/>Items may be combined to stacks. The package size determines the amount of this items you will receive
from a shop keeper. For example, buying "a dozen arrows" will add a stack of 12 arrows to your quiver.<p class="paragraph"/><h3>Usable and rechargeable items</h3><p class="paragraph"/>Some items can be used (activated) to create special effects, which may consume the item or reduce its
 life expectancy by one. A potion will have only one use, while a laster blaster may have a 100 shots
  before it can be recharged.<p class="paragraph"/><h3>Value and availability</h3><p class="paragraph"/>Availability is currently defined in 0.1% steps - so it's a number from 0 to 1000. Items with an 
  availability of zero will never be found in a shop, while others will be on sale some or all the time.
The base value of an item is used to calculate the price a shop keeper will pay for it.<p class="paragraph"/><h2>Item properties</h2><p class="paragraph"/>An item has other properties besides its type. Those are:
<ul class="star">
<li>an owner: a Creature (may be a mob, but most likely it's a player character)</li>
<li>a location: currently, two location types are defined: ON_PERSON and AT_HOME</li>
<li>a gold value: game events may change the value of an item.</li>
<li>amount: for stacked items, default is 1</li>
<li>equipped flag: true if the item is currently in use.</li>
<li>number of uses left</li>
<li>resources: an item may be designed to be used as a production resource in crafting.</li>
</ul><p class="paragraph"/>    A player may choose between several stacks of raw materials to use for a product,
    and the chosen stack is marked internally for consumption.


<h2 id="crafting">3.8 Crafting</h2>
Crafting in games can be defined as the controlled and repeatable creation of items by player characters,
 based on their personal resources (materials, skills, time).<p class="paragraph"/>The Little Goblin crafting system allows for production of all kinds of items that a character might want to use.
To create an item, a PC should have a corresponding crafting skill, the material components and the proper tools.
As with many other online games, crafting takes time - you can define how long it will take a player to create
an item.<p class="paragraph"/><h3>Tools</h3><p class="paragraph"/>Many crafting systems require the presence of components, but few consider the use of multiple tools for crafting.
Little Goblin offers the chance to create recipes for items that define what other non-consumable items the player
(or, later on, his order) has to own to craft a new item.<p class="paragraph"/>At the moment, the quality of tools is not mapped to the crafted item's quality, but that could be an interesting
 idea for further extensions.<p class="paragraph"/><h3>Production lines</h3><p class="paragraph"/>Currently, a player can start the production of create several items of a each kind, as long as he has the required 
components to create at least one item of this type. When the required time is up, the code checks if the resources
are available and then generates the item. 
So it is possible to start a "create 99 gold-tipped arrows, which requires 10 hours"
production task while owning only one gold nugget, and then start another process to 
"create 98 gold nuggets from gold ore in 9 hours"<p class="paragraph"/>Note: Work in progress: The crafting and the skill learning system currently rely on external "ticks", that is http calls
to the API made by a cron job, which causes specific service classes to check if items are to be generated or skills
will be learned by characters etc. This is sub-optimal and will be replaced by background-threads in the future.<p class="paragraph"/><h4>Design considerations</h4><p class="paragraph"/>A more "realistic" way would be to subtract the required resources each time an item is generated, but on the other
hand it is a better system than requiring all resources up front, which would mean that in our example the player has 
to login after 9 hours, when the 99 gold nuggets are ready, and then create the next 10 hour job of crafting the arrows.
This leads to unhealthy gaming patterns where players will stay up late or rise early, 
just to submit a task to an online game on time.<p class="paragraph"/><p class="paragraph"/> 


<h2 id="orders">3.9 Orders</h2>
Players may create orders (which are called guilds in some games). An order offers a means to
communicate with friends by using the Chatterbox (private chat channel on the order page).<p class="paragraph"/>Each player may create his or her own order and wait for other players to send application messages
for their characters, which can be accepted or denied. The founder of a guild is also its master.
A player character may only be the member of one order.<p class="paragraph"/><h3>Roadmap for orders</h3><p class="paragraph"/>Orders are currently very simple. They will probably be extended to include:
<ul class="star">
<li>A treasure chest for exchanging items for free.</li>
<li>A production / crafting facility to share tools / machines.</li>
<li>An organization chart for large orders.</li>
<li>The option to add a logo and a more detailed description.</li>
</ul><p class="paragraph"/>


<h2 id="quests">3.10 Quests</h2>
Quests are multi-step events that a player character experiences and whose outcome is more or less dependent on the
player's choices and possible random factors.<p class="paragraph"/>Quests are granted by a QuestGiver, a non-player-character, which may have a short description and an introductory
text. The player decides whether to take on a quest or leave it. If the player character dies or runs away from a 
quest, it is counted as failed and cannot be repeated.<p class="paragraph"/>Each quest consists of several steps, which are QuestStep objects chained together by the game designer. You can
create extremely long quests, with random encounters and scripted outcomes depending on special circumstances. It
  is even possible to have looping quests. For example, if the player returns repeatedly to a series of quest steps,
  until he makes the correct (or final) decision which ends the quest successfully or causes it to fail.<p class="paragraph"/>At the end of quest (or, by script, during a quest step), rewards can be given to a character. Those may take the
 form of items or non-material bonuses like reputation changes. The reference implementation has an example quest
 where the player decides if he wants to rescue an elven girl and reunite her with her family or give her to 
 the dwarves. The decision results in a change to reputation with both factions (elves and dwarves).<p class="paragraph"/>Entry criteria for quests are planned, but not implemented yet. For example, I would like to implement reputation
dependent quests - if a player character is known as a friend of the gnomes, he may get some quests from them&#8230;



<h1 id="implementation">4 Plugin Usage</h1>
So, you want to create your own game. That's great.<p class="paragraph"/>This chapter describes how to create a new game by using the Little Goblin plugin.
As an example I will use the reference implementation, which is currently (as of version 0.3.2)
a part of the main plugin, but should really be put into a separate application to
keep framework and individual game mechanics apart.<p class="paragraph"/>So follow along for a tour &#8230; you can find the source code at GitHub:
<a href="https://github.com/dewarim/schedim" target="blank">Schedim source code</a>



<h2 id="create">4.1 How to create a new game</h2>
<h3>A new app</h3><p class="paragraph"/>Create a new grails application. On the command line type:<p class="paragraph"/><div class="code"><pre>grails create&#45;app schedim</pre></div><p class="paragraph"/>Of course, it would be nice if you were to come up with your own name instead of Schedim ;)
Schedim are a kind of mythological creatures from the Kabbalah (elemental spirits).<p class="paragraph"/>Grails creates a new application in a folder by the given name (schedim). Open the application
in your favorite IDE, for example Eclipse STS or IntelliJ IDEA. It is also a good idea to
create a repository for the software in a source code management system like git or subversion.
If you got your game in a SCM (and keep backups...), you do not have to fear losing your code
or breaking it beyond repair by making changes to it.<p class="paragraph"/>Your new grails application should start out looking like this:<p class="paragraph"/><img border="0" class="center" src="../img/game/new_grails_app.png"></img><p class="paragraph"/>In the new application, open grails-app/conf/BuildConfig.groovy and add the line<p class="paragraph"/><div class="code"><pre>compile ':goblin:0.3.2'</pre></div><p class="paragraph"/>to the dependencies closure.<p class="paragraph"/>If you now type<p class="paragraph"/><div class="code"><pre>grails
    // waiting some time
    grails run&#45;app
    // waiting some more</pre></div><p class="paragraph"/>You will see a message like "Server running. Browse to http://localhost:8080/schedim"
If you visit this URL, you will see something like the following:<p class="paragraph"/><img border="0" class="center" src="../img/game/raw_game.png"></img><p class="paragraph"/>The many controllers are provided by Little Goblin. But since the database is still empty
and no start page has been defined, we still have some work to do.<p class="paragraph"/><h3>Landing page configuration</h3><p class="paragraph"/>As you can see, the default page of the new game leaves something to be desired. But we can
redirect visitors from the base URL to a page of our own choosing.<p class="paragraph"/>In the file grails-app/conf/UrlMappings.groovy, modify the static mappings definition:<p class="paragraph"/><div class="code"><pre>class UrlMappings &#123;
    <span class="java&#45;keyword">static</span> mappings = &#123;
      <span class="java&#45;quote">"/$controller/$action?/$id?"</span>&#123;
	      constraints &#123;<p class="paragraph"/>		  &#125;
	  &#125;
      <span class="java&#45;quote">"/"</span>(view:<span class="java&#45;quote">"/portal/landing"</span>)
	  <span class="java&#45;quote">"500"</span>(view:'/error')
	&#125;
&#125;</pre></div><p class="paragraph"/>Now, if you visit http://localhost:8080/schedim, you should be redirected to the Little Goblin's
default <a href="../guide/single.html#landing" class="guide">landing page</a>:<p class="paragraph"/><img border="0" class="center" src="../img/game/first_landing_page.png"></img><p class="paragraph"/>This still does not look like the test server's page, but it's a start.<p class="paragraph"/><h3>Database installation</h3><p class="paragraph"/>You may run your game entirely from RAM without any persistent database installed.
But while this is great for testing (you get a new database with every start), for a
production setting it will probably be less than ideal, because you loose your entire game state
once the server shuts down.<p class="paragraph"/>If you want to go beyond an in-memory setup, you should install a proper database like 
<a href="http://www.postgresql.org" target="blank">Postgresql</a> - this is easy to setup. On Windows, you can use PgAdmin 
which comes with the database executable to setup a first database called schedim, with 
 a user goblin and password goblin.<p class="paragraph"/>If you decide to go with Postgresql (you could also use MySQL or MS-SQLserver etc),
please add the following postgresql driver to you dependencies closure in BuildConfig.groovy:<p class="paragraph"/><div class="code"><pre>dependencies&#123;    
        // automatically download and install the Postgresql driver:
        runtime 'postgresql:postgresql:9.1&#45;901.jdbc4'
        // or use the MySQL one:
        // runtime 'mysql:mysql&#45;connector&#45;java:5.1.20'
    &#125;</pre></div><p class="paragraph"/>Please note that depending on the Postgresql or Mysql configuration, you may need to allow
connections from localhost:<p class="paragraph"/><div class="code"><pre>&#45;&#45;&#45; in pg_hba.conf: add a separate line:
 host	schedim	     all	127.0.0.1/32	      trust</pre></div><p class="paragraph"/><h3>Database configuration</h3><p class="paragraph"/>Next you will need to configure the connection to the database. This is stored in /grails-app/conf/DataSource.groovy<p class="paragraph"/>There are three distinct environments under which your game will be running - 
<ul class="star">
<li>development, which means you run it via run-app from the Grails console.</li>
<li>test, during testing the game will be running with the in-memory H2 database (leave settings as-are).</li>
<li>production, which is activated when the schedim.war is deployed into a Tomcat (or other) server.</li>
</ul><p class="paragraph"/>Add the following settings to your DataSource.groovy:<p class="paragraph"/><div class="code"><pre>environments&#123;
    development &#123;
		dataSource &#123;
			dbCreate = <span class="java&#45;quote">"update"</span>
			pooling = <span class="java&#45;keyword">true</span>
			logSql = <span class="java&#45;keyword">false</span>
			driverClassName = <span class="java&#45;quote">"org.postgresql.Driver"</span>
            dialect = <span class="java&#45;quote">"org.hibernate.dialect.PostgreSQLDialect"</span>
            url = <span class="java&#45;quote">"jdbc:postgresql://127.0.0.1:5432/schedim"</span>			
			username = 'goblin'
			password = 'goblin'
		&#125;<p class="paragraph"/>	&#125;<p class="paragraph"/>	production &#123;
		dataSource &#123;
			dbCreate = <span class="java&#45;quote">"update"</span>
			pooling = <span class="java&#45;keyword">true</span>
            logSql = <span class="java&#45;keyword">false</span><p class="paragraph"/>            driverClassName = <span class="java&#45;quote">"org.postgresql.Driver"</span>
            dialect = <span class="java&#45;quote">"org.hibernate.dialect.PostgreSQLDialect"</span>
            url = <span class="java&#45;quote">"jdbc:postgresql://127.0.0.1:5432/schedim"</span>
			username = 'goblin'
			password = 'goblin'
            autoReconnect = <span class="java&#45;keyword">true</span>
            properties &#123;
                maxActive = &#45;1
                minEvictableIdleTimeMillis=1800000
                timeBetweenEvictionRunsMillis=1800000
                numTestsPerEvictionRun=3
                testOnBorrow=<span class="java&#45;keyword">true</span>
                testWhileIdle=<span class="java&#45;keyword">true</span>
                testOnReturn=<span class="java&#45;keyword">true</span>
                validationQuery=<span class="java&#45;quote">"SELECT 1"</span>
            &#125;
		&#125;
	&#125;
&#125;</pre></div><p class="paragraph"/>If you are using MySQL, use the following lines:<p class="paragraph"/><div class="code"><pre>driverClassName = <span class="java&#45;quote">"com.mysql.jdbc.Driver"</span>
		dialect = 'org.hibernate.dialect.MySQL5InnoDBDialect'
		url = <span class="java&#45;quote">"jdbc:mysql://localhost:3306/schedim"</span></pre></div><p class="paragraph"/>Note the setting for dbCreate: currently they are all set to update,
so that Grails tries to add anything new you create. It should not delete
any database tables or otherwise break something, just add new stuff.<p class="paragraph"/>Once you have a production-ready game, you should set dbCreate to 'none'
in the production environment settings.<p class="paragraph"/><h3>Security configuration</h3><p class="paragraph"/>Little Goblin uses the Grails Spring Security Plugin to enable authentication and authorization of
 users. You may of course decide to use another security mechanism (or write a game that does not
 require a login...) but I recommend you just use the following settings in your Config.groovy - 
 after all, Little Goblin is about reducing the time for setup.<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.userLookup.userDomainClassName = 'de.dewarim.goblin.UserAccount'
 grails.plugins.springsecurity.userLookup.authorityJoinClassName = 'de.dewarim.goblin.UserRole'
 grails.plugins.springsecurity.authority.className = 'de.dewarim.goblin.Role'
 grails.plugins.springsecurity.userLookup.passwordPropertyName = 'passwd'
 grails.plugins.springsecurity.authority.nameField = 'name'
 grails.plugins.springsecurity.successHandler.defaultTargetUrl = '/portal/start'
 grails.plugins.springsecurity.dao.reflectionSaltSourceProperty = 'username'</pre></div><p class="paragraph"/>You may have noticed the defaultTargetUrl: by changing this you can determine to which page a user
 will be redirected after login by default. In this case it's the start action of the portal controller.<p class="paragraph"/>If you now visit the login page and try to login with the default test user,
you will see an error message - which is perfectly ok at this moment, since there are no users
in the database.<p class="paragraph"/><img border="0" class="center" src="../img/game/first_failed_login.png"></img>
First failed login: your game is secure...<p class="paragraph"/><h3>Adding data</h3><p class="paragraph"/>At the moment, your database is completely empty - it should contain just the tables for the 
Little Goblin domain classes, but not a single row of data. That is about to change...<p class="paragraph"/>// TODO


<h2 id="landing">4.2 The landing page</h2>
A browsergame starts with a landing page, where the visitor gets a first impression on what the site is all about.<p class="paragraph"/>The landing page is mostly static. It can be found in grails-app/views/portal/landing.gsp<p class="paragraph"/>It contains the following parts:
<ul class="star">
<li>The links to the login and registration pages</li>
<li>The optional Facebook like button</li>
<li>A language chooser (currently supported: French and English)</li>
<li>Some information about Little Goblin</li>
</ul><p class="paragraph"/>The layout is governed by a special file, the sitemesh layout definition in grails-app/views/layouts/main.gsp.<p class="paragraph"/>If you want to change the general look and feel, making changes to main.gsp is the easiest way to get this done.
This file also includes the CSS responsible for styling the HTML elements. That file can be found in
web-app/css/main.css.<p class="paragraph"/>So, to change the landing page, you can start with:
<ul class="star">
<li>grails-app/views/portal/landing.gsp</li>
<li>grails-app/views/layouts/main.gsp</li>
<li>web-app/css/main.css</li>
</ul><p class="paragraph"/>To activate the Facebook like button, edit your application-config.groovy file (named after your application,
 for example goblin-config.groovy) and add:<p class="paragraph"/><div class="code"><pre>facebook &#123;
    // <span class="java&#45;keyword">this</span> enables Facebook&#45;JavaScript snippets on your landing page:
    enabled=<span class="java&#45;keyword">true</span>
    // show the like button:
    enableLikeButton = <span class="java&#45;keyword">true</span><p class="paragraph"/>    // <span class="java&#45;keyword">if</span> set to <span class="java&#45;keyword">true</span>, allow login via Facebook &#45; not implemented yet.
    enableFacebookLogin = <span class="java&#45;keyword">false</span><p class="paragraph"/>     // your server's URL and Facebook appId
    myUrl = 'http://schedim.de/'
    appId = '217240194988212'
&#125;</pre></div>


                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
